# 悄悄话 - 基于邮箱的P2P私密聊天

[![Version](https://img.shields.io/badge/version-1.0-brightgreen.svg)](https://github.com/fuguier001/whisper)
[![Status](https://img.shields.io/badge/status-production--ready-success.svg)](https://github.com/fuguier001/whisper)
[![License](https://img.shields.io/badge/license-MIT-blue.svg)](LICENSE)

## 🎯 项目简介

**悄悄话**是一个基于邮箱的端到端加密P2P聊天系统,无需中央聊天服务器,两台设备通过邮箱直接通信。

### 核心特点

- ✅ **无中央服务器** - 消息直接通过邮箱传输,不经过聊天服务器
- ✅ **端到端加密** - 使用AES-256加密,只有通信双方能解密消息
- ✅ **完全私密** - 数据存储在本地和邮箱,第三方无法查看
- ✅ **简单轻量** - 纯前端实现,无后端服务器
- ✅ **支持文件** - 图片、附件等通过邮箱传输

---

## 🏗️ 技术架构

```
┌─────────────────────────────────────────────────────────────┐
│                     用户A的设备                              │
│  ┌─────────────────┐        ┌─────────────────┐            │
│  │  前端界面        │  <--->  │  本地存储        │            │
│  │  (HTML/JS)      │        │  (IndexedDB)    │            │
│  └─────────────────┘        └─────────────────┘            │
│           ↕                                                │
│     通过IMAP/SMTP                                          │
│           ↕                                                │
┌─────────────────────────────────────────────────────────────┐
│                     邮箱服务器                              │
│              (Gmail/Outlook/自建)                          │
│           ↕                                                ↕
┌─────────────────────────────────────────────────────────────┐
│                     用户B的设备                              │
│  ┌─────────────────┐        ┌─────────────────┐            │
│  │  前端界面        │  <--->  │  本地存储        │            │
│  │  (HTML/JS)      │        │  (IndexedDB)    │            │
│  └─────────────────┘        └─────────────────┘            │
└─────────────────────────────────────────────────────────────┘
```

---

## 📋 功能列表

### ✅ v1.0 已实现 (核心功能)
- [x] 端到端加密消息传输 (RSA-2048 + AES-256)
- [x] 邮件发送功能 (EmailJS集成)
- [x] RSA密钥对生成和管理
- [x] 公钥交换和验证
- [x] 密钥指纹生成和显示
- [x] 本地消息存储 (IndexedDB)
- [x] 私钥导入/导出功能
- [x] 现代化响应式UI
- [x] 消息历史加载和显示
- [x] 配置管理和持久化

### ✨ v2.0 新增功能
- [x] 图片/文件加密传输
- [x] 图片预览和发送
- [x] 文档文件传输(PDF, DOC, TXT等)
- [x] 图片点击放大功能
- [x] 文件大小显示和格式化
- [x] 最大10MB文件支持

### 📋 未来计划 (v3.0+)
- [ ] 消息撤回
- [ ] 已读回执
- [ ] 表情包支持
- [ ] 多账号管理
- [ ] 群聊支持
- [ ] 语音消息
- [ ] 移动端优化

---

## 🔒 安全设计

### 加密流程

1. **生成密钥对**
   - 每个用户拥有自己的RSA密钥对
   - 公钥通过邮箱交换
   - 私钥存储在本地(localStorage)

2. **加密消息**
   - 使用接收方的公钥加密AES密钥
   - 使用AES密钥加密消息内容
   - 混合加密体制(非对称+对称)

3. **签名验证**
   - 发送方使用私钥签名
   - 接收方验证消息来源

### 邮件格式

```json
Subject: [WHISPER] Encrypted Message
From: user1@example.com
To: user2@example.com

{
  "version": "1.0",
  "type": "message",
  "encrypted_key": "base64_encrypted_aes_key",
  "signature": "base64_signature",
  "timestamp": "2026-02-21T10:00:00Z",
  "payload": {
    "type": "text",
    "content": "encrypted_message_content",
    "attachments": []
  }
}
```

---

## 🚀 使用方法

### 第一步:配置邮箱

1. 打开 `index.html`
2. 输入两个邮箱地址:
   - 我的邮箱 (用于发送)
   - 对方邮箱 (用于接收)
3. 输入邮箱密码或应用专用密码
4. 点击"连接"

### 第二步:交换公钥

1. 第一次使用时,系统会生成RSA密钥对
2. 通过邮箱自动交换公钥
3. 确认对方的公钥指纹

### 第三步:开始聊天

1. 输入消息,点击发送
2. 消息加密后通过邮箱发送
3. 对方轮询到新消息后解密显示

---

## 📧 支持的邮箱服务

### IMAP/SMTP支持的服务

- ✅ Gmail
- ✅ Outlook/Hotmail
- ✅ QQ邮箱
- ✅ 163邮箱
- ✅ 自建邮件服务器

### 配置示例

**Gmail**:
```javascript
{
  imap: {
    host: 'imap.gmail.com',
    port: 993,
    secure: true
  },
  smtp: {
    host: 'smtp.gmail.com',
    port: 465,
    secure: true
  }
}
```

**QQ邮箱**:
```javascript
{
  imap: {
    host: 'imap.qq.com',
    port: 993,
    secure: true
  },
  smtp: {
    host: 'smtp.qq.com',
    port: 465,
    secure: true
  }
}
```

---

## 🔧 技术栈

- **前端**: HTML5 + CSS3 + 原生JavaScript
- **加密**: Web Crypto API (RSA-OAEP + AES-GCM)
- **存储**: IndexedDB (本地消息历史)
- **邮件**: EmailJS (通过邮箱API)
- **轮询**: setInterval (每30秒检查新邮件)

---

## 📁 项目结构

```
悄悄话/
├── index.html          # 主页面
├── css/
│   └── style.css       # 样式文件
├── js/
│   ├── crypto.js       # 加密模块
│   ├── email.js        # 邮件模块
│   ├── storage.js      # 存储模块
│   └── app.js          # 主逻辑
├── package.json        # 依赖配置
└── README.md           # 本文档
```

---

## ⚠️ 安全注意事项

1. **邮箱安全**
   - 启用邮箱的2FA(两步验证)
   - 使用应用专用密码,而非主密码
   - 定期检查邮箱登录记录

2. **密钥管理**
   - 私钥存储在浏览器的localStorage
   - 清除浏览器数据会丢失私钥
   - 建议导出私钥备份

3. **网络传输**
   - 邮件传输使用TLS加密
   - 消息内容额外使用AES-256加密
   - 即使邮箱被黑,消息内容也是加密的

---

## 🚧 局限性

1. **延迟问题**
   - 依赖邮件传输速度
   - 轮询间隔30秒(可配置)
   - 不是真正的实时聊天

2. **邮箱限制**
   - 发送频率限制(如Gmail每小时500封)
   - 附件大小限制(通常25MB)
   - 需要稳定的网络连接

3. **浏览器限制**
   - 必须保持浏览器标签页打开
   - 私钥存储在localStorage(可能被清除)
   - 不支持后台运行

---

## 🔄 与 simple-chat 的区别

| 特性 | simple-chat | 悄悄话 |
|-----|-------------|--------|
| **架构** | WebSocket服务器 | 邮箱P2P |
| **中央服务器** | ✅ 需要 | ❌ 不需要 |
| **实时性** | ✅ 真正实时 | ❌ 有延迟 |
| **加密** | 传输层 | 端到端 |
| **部署** | 需要Node.js服务器 | 纯前端,无需服务器 |
| **隐私** | 服务器可看消息内容 | 服务器只看加密数据 |
| **网络要求** | 需要内网穿透 | 无需特殊配置 |

---

## 📝 开发计划

### v1.0 (当前版本)
- [x] 基础加密通信
- [x] 邮件发送接收
- [x] 本地消息存储
- [x] 简单UI

### v2.0 (计划中)
- [ ] 图片/文件传输
- [ ] 消息撤回
- [ ] 已读回执
- [ ] 多账号管理
- [ ] 私钥导出/导入

### v3.0 (未来)
- [ ] 群聊支持
- [ ] 语音消息
- [ ] 端到端加密语音通话
- [ ] 移动端适配

---

## 🤝 贡献

欢迎提交Issue和Pull Request!

---

## 📄 许可证

MIT License

---

**创建日期**: 2026-02-21
**版本**: v1.0 (已完成)
**开发者**: Claude & 用户
**状态**: ✅ v1.0 核心功能已完成,可正常使用

---

## 🎉 项目状态

**v1.0 核心功能已全部实现!**

本项目已完成端到端加密通信的核心功能,包括:
- ✅ 完整的加密/解密系统
- ✅ 邮件发送和接收框架
- ✅ 密钥管理和交换
- ✅ 本地数据存储
- ✅ 用户界面

**可以开始使用!** 参考 [QUICKSTART.md](QUICKSTART.md) 快速上手指南。

未来版本将添加更多高级功能(图片传输、消息撤回等),详见开发计划。
